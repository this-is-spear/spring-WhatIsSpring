
## 스프링 컨테이너
스프링 컨테이너는 XML 기반으로 만들 수 있고, 애너테이션 기반의 자바 설정 클래스로 만들 수 있다.
AppConfig 클래스를 이용해 설정하는 방법은 애너테이션 기반의 자바 설정 클래스로 설정하는 방법이다.

### IoC, DI 컨테이너, 스프링 컨테이너 이게 뭐야?

#### 제어의 역전(Inversion of Control)을 우선 알아보자.

기존 프로그램은 클라이언트 구현 객체가 스스로 필요한 서버 구현 객체를 생성하고, 호출하고 실행했다.
한마디로 프로그램의 흐름을 구현 객체 스스로가 조종했다.

반면에 AppConfig 클래스가 등장한 이후에 구현 객체는 자신의 로직을 실행하는 역할만 담당하면서 제어 흐름을
**외부에서 관리하게 된 것을 제어의 역전(IoC)이라고 한다.**
즉, 외부에서 의존성 주입을 하는 DI(의존관계 주입) 컨테이너, 외부에서 관리하는 IoC 컨테이너, 스프링 컨테이너는 DI 컨테이너라고 부르기도 하고, IoC컨테이너라고 부른다.

**AppConfig 클래스는 IoC 컨테이너이며, DI 컨테이너다.**


#### AppConfig 클래스를 스프링 컨테이너로 만들기 

현재까지 AppConfig 클래스를 사용해서 직접 객체를 생성하고 의존성 주입을 했지만, 이제부터는 스프링 컨테이너를 통해 사용한다. 스프링 컨테이너는 @Configuration 애너테이션이 붙은 AppConfig 클래스를 설정 정보로 사용한다.

@Configuration 애너테이션을 이용해 스프링 컨테이너로 만들고 @Bean 어노테이션을 사용해 스프링 컨테이너에 등록을 한다.
여기서 @Bean 애너테이션이 적힌 메서드를 모두 호출해서 반환된 객체를 스프링 컨테이너에 등록한다. 이렇게 스프링 컨테이너에 등록된 객체를 스프링 빈이라 한다.

### 스프링 컨테이너를 사용하면 좋은 장점이 뭘까? 
#### 2021-12-23 추가
@Configuration 애너테이션 붙이지 않고 오로지 자바로만 작성을 한다면 후에 동시성 문제가 생긴다. 자바로만 작성한 설정 정보 파일은 해당 구현체들이 호출될 때마다 계속해서 객체들을 생성해 줄 것이고,
처음 불렀던 객체와 중간에 불렀던 객체, 그리고 마지막으로 불렀던 객체가 타입은 같지만 실제 주소는 틀리게 되어 전혀 다른 객체가 만들어진다. 그렇게 되면 개발자의 의도대로 서비스를 할 수 없게 되어버린다. 이런 상황을 막기 위해 스프링은 스프링 컨테이너를 제공해 계속 호출되어 생성되는 것을 막고, 하나의 객체만을 생성해 계속 사용할 수 있게 만드는 싱글톤 방식을 제공한다.


### 스프링 컨테이너 생성 과정

#### 테스트 상에서 @Configuration 애너테이션을 이용한 구성 설정 파일과 @Bean 애너테이션 구현체를 이용한 컨테이너 생성과정

1. 스프링 컨테이너 생성
   1. new AnnotationConfigApplicationContext(AppConfig.class)
   2. 스프링 컨테이너를 생성할 때, AppConfig 클래스와 같은 구성 정보를 지정해야 한다.
2. 스프링 빈 등록
   1. @Bean 애너테이션을 붙여 파라미터로 넘어온 설정 클래스 정보를 사용해 스프링 빈을 등록한다.
   2. 빈 이름은 임의로 부여할 수 있다.
      @Bean(name="blaService")
   3. **주의 사항**
      > 스프링 빈 이름은 항상 서로 다른 이름이어야 한다. 같은 이름을 부여하면, 기존 빈은 덮어버리거나 실행에
오류가 발생한다.
3. 스프링 빈 의존관계 설정 준비
4. 스프링 빈 의존관계 설정 완료
   1. 동적인 의존 관계
   2. 정적인 의존 관계
   3. 스프링 컨테이너는 설정 정보를 참고해서 의존 관계를 주입(DI)한다.
   4. 단순히 자바 코드를 호출하는 것 같지만 차이가 존재한다.

#### 참고
스프링은 빈을 생성하고 의존관계를 주입하는 단계로 나뉘어져 있다. 그런데 자바 코드로 스프링 빈을 등록하면
생성자를 호출하면서 의존관계 주입도 한번에 처리된다. 

#### 개발 환경 상에서는?
실제로는 스프링 컨테이너가 자동으로 실행이 되고, @SpringBootApplication 애너테이션 안에 있는 @ComponentScan 을 이용해 모든 @Component 애너테이션이 붙은 클래스를 빈들을 저장한다.
- @Configuration 안에 있는 구성 설정 정보 클래스에 있는 수동 등록한 @Bean 들을 넣는다. (@Configuration 애너테이션 안에도 @Component 애너테이션이 붙었다.)
- @Component, @Service, @Controller, @Repository 애너테이션이 붙은 클래스를 스프링 빈에 저장한다.

**여기서**  빈들을 무작정 집어 넣다 중복하는 이름과 타입 때문에 충돌이 일어날 때, 어떻게 해야하는가에 생각을 해봐야 한다. 그 방법에 대해서는 따로 작성하겠다.
@Component, @Service, @Controller, @Repository 애너테이션이 붙어서 등록되는 방법을 자동 등록 방법이라 하고, 구성 설정 정보 클래스에 @Bean 애너테이션을 이용해 등록하는 방법을 수동 등록이라 한다.
